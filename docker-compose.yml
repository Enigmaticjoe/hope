version: "3.8"
name: brawn-omni-stack

services:
  # --- THE HEART: DEBRID UNLIMITED MEDIA BRIDGE ---
  dumb:
    image: iampuid0/dumb:latest
    container_name: DUMB
    restart: unless-stopped
    runtime: nvidia # PASSTHROUGH FOR YOUR 4070
    stdin_open: true
    tty: true
    ports:
      - "32400:32400" # Plex
      - "3005:3005"   # DUMB Management UI
      - "8090:8080"   # Zurg Web UI
      - "9696:9696"   # Prowlarr
      - "8989:8989"   # Sonarr
      - "7878:7878"   # Radarr
    environment:
      - PUID=99
      - PGID=100
      - TZ=America/New_York
      - NVIDIA_VISIBLE_DEVICES=all
      - PLEX_CLAIM=${PLEX_CLAIM}
      - RD_API_KEY=${RD_API_KEY}
      - ZURG_ENABLED=true
      - RCLONE_MOUNT_NAME=pd_zurg
    volumes:
      - /mnt/user/appdata/dumb/config:/config
      - /mnt/user/appdata/dumb/log:/log
      - /mnt/user/media:/data
      - /mnt/disks/realdebrid:/mnt/debrid:shared
      - /dev/shm:/transcode
    cap_add:
      - SYS_ADMIN
    devices:
      - /dev/fuse:/dev/fuse
      - /dev/dri:/dev/dri
    security_opt:
      - apparmor:unconfined

  # --- THE SHIELD: LOCAL TORRENTS VIA MULLVAD ---
  qbittorrent:
    image: binhex/arch-qbittorrentvpn:latest
    container_name: qbittorrent_vpn
    restart: unless-stopped
    ports:
      - "8080:8080"
      - "6881:6881"
      - "6881:6881/udp"
    environment:
      - PUID=99
      - PGID=100
      - VPN_ENABLED=yes
      - VPN_PROV=custom
      - VPN_CLIENT=wireguard
      - LAN_NETWORK=192.168.1.0/24
      - NAME_SERVERS=1.1.1.1,8.8.8.8
    volumes:
      - /mnt/user/appdata/qbittorrent:/config
      - /mnt/user/media/downloads:/downloads
    cap_add:
      - NET_ADMIN

  # --- THE BACKUP: STREMIO ---
  stremio:
    image: tsaridas/stremio-docker:latest
    container_name: stremio
    restart: unless-stopped
    ports:
      - "8089:8080"
      - "11478:11470"
    volumes:
      - /mnt/user/appdata/stremio:/root/.stremio-server
